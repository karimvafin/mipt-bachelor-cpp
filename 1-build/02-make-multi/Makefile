# Компилятор C++.
CXX := g++
# Флаги компиляции: стандарт, оптимизация, предупреждения.
CXXFLAGS := -std=c++20 -O2 -Wall -Wextra
# Флаги препроцессора: путь к заголовкам.
CPPFLAGS := -Iinclude
# Каталог для объектных файлов.
BUILD_DIR := build
# Путь к итоговому бинарнику.
TARGET := bin/app

# Поиск всех исходников в src (включая подкаталоги).
SRCS := $(shell find src -name '*.cpp')
# Преобразование путей src/*.cpp в build/*.o.
OBJS := $(patsubst src/%.cpp,$(BUILD_DIR)/%.o,$(SRCS))
# Список файлов зависимостей, соответствующий объектам.
# DEPS := $(OBJS:.o=.d)

# Линковка бинарника из всех объектных файлов.
$(TARGET): $(OBJS)
	# Создание директории для бинарника.
	@mkdir -p $(dir $@)
	# Линковка всех объектов.
	$(CXX) $(CXXFLAGS) -o $@ $^

# Шаблонное правило компиляции исходников в build/*.o.
$(BUILD_DIR)/%.o: src/%.cpp
	# Создание директории для объекта.
	@mkdir -p $(dir $@)
	# Компиляция + генерация файлов зависимостей .d.
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

# Подключение автогенерируемых зависимостей.
# -include $(DEPS)

# Объявление фиктивных целей.
.PHONY: run clean
# Запуск собранной программы.
run: $(TARGET)
	# Запуск бинарника.
	./$(TARGET)

# Очистка артефактов сборки.
clean:
	# Удаление build/ и bin/ с артефактами.
	rm -rf $(BUILD_DIR) bin
